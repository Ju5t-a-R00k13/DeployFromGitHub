<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" type="image/png" sizes="16x16" href="img/icon16x16.png">
    <title>My Little Shop</title>
    <link href="css/lib/bootstrap/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <!-- script -->
    <script src="js/jquery/jquery.min.js"></script>
    <script src="js/bootstrap/bootstrap.js"></script>
    <script src="js/variable.js"></script>
    <script src="js/function.js"></script> 
    <script src="https://www.gstatic.com/firebasejs/4.13.0/firebase.js"></script>
    <script src="js/init.js"></script>
</head>
<body>
    <div class="main-wrapper">
        <div class="header">
            <nav class="navbar top-navbar navbar-expand-md navbar-light">
                <!-- Logo -->
                <div class="navbar-header">
                    <a class="navbar-brand " href="index.html">
                        <!-- Logo icon -->
                        <b><img src="img/logo.png" alt="homepage" class="dark-logo" /></b>
                        <!-- Logo text -->
                        <span>My Little Shop"</span>
                    </a>

                </div>
       
               
            </nav>
        </div>
        <div class="left-sidebar">
                
        </div>
        <div class="page-wrapper">
            <div class="container-fluid ">
                <div class="row" id="content">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-title form-title">
                                <h4>Add User</h4>
                            </div>
                            <div class="card-body">
                                <div class="basic-form">
                                    <form>
                                        <div class="form-group col-lg-12">
                                            <p class="text-muted m-b-15 f-s-12">Username</p><input type="text" class="form-control input-default" id="username" placeholder=""></div>
                                        <div class="form-group col-lg-12">
                                            <p class="text-muted m-b-15 f-s-12">Password</p><input type="password" class="form-control input-default " id="password" placeholder=""></div>
                                        <div class="form-group col-lg-5">
                                            <p class="text-muted m-b-15 f-s-12 ">Role</p><select class="form-control" id="roleSelect"></select></div>
                                        <div class="form-group col-lg-5">
                                            <p class="text-muted m-b-15 f-s-12 ">Shop No.</p><input type="text" class="form-control input-default" id="shopNo" placeholder=""></div><br><button class="btn btn-success" type="button" onclick="import_user()">Import</button></form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script src="js/app.js"></script>
<script>

  function import_user(){
    var username= document.getElementById('username').value;
    var password= document.getElementById('password').value;
    var role = 1;
    if(document.getElementById('roleSelect').value == "Employee"){
        role = 2;
    }

    var shop_id = document.getElementById('shopNo').value;  
    var i = 0;

    var data = {
      password: password,
      role: role,
      shop_id: shop_id
    }
     
    var updates = {};
    var databaseRef = firebase.database().ref('employee/');
    var exist = false;

    databaseRef.once('value', function(snapshot) {
      snapshot.forEach(function(childSnapshot) {
        var childKey = childSnapshot.key;
        if(username == childKey){
          exist = true;
        }
      });

      if(exist){
        alert('Username exist!');
      }else{
        updates['/employee/' + username] = data;
        firebase.database().ref().update(updates);
        alert('The user is created successfully!');
        reload_page();
      }      
    });


  }

  function reload_page(){
     window.location.reload();
  }
</script>

</html>